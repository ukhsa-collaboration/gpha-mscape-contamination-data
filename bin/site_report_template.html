<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="https://raw.githubusercontent.com/artic-network/scylla/main/docs/mscape.svg">

<title>${site_name} Report</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
<style>

body {
    padding-top: 50px;
    font-family: "ArialNova-Light","HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
    max-width: 1200px !important;
    min-width: 210mm !important;
    -webkit-print-color-adjust:exact;
    margin: auto;
}

.container {
    min-width: 210px !important;
}
            

header {
    display: block;
    text-align: right;

}

svg {width: 90%; height: auto;}


.center {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 50%;
}


    h1 {
    color: #161B33;
    font-size: 32px;
    font-weight: 300;
    text-align: left;
}

    h2 {
    color: #364652;
    font-size: 26px;
    font-weight: 100;
    margin: 0 auto 20px auto;
}

.svg-icon {
    display: inline-flex;
    align-self: center;
}

h3 {
    font-size: 24px;
    margin: 0;
    padding: 15px 0 15px 0;
    font-family: inherit;
    font-weight: 500;
    line-height: 1.1;
}

.no_padding {
    font-size: 24px;
    padding: 0 0 0 0;
}


    h4 {
    color: #466995;
    font-family: inherit;
    font-weight: 300;
    letter-spacing: 2px;
    text-align: center;
    text-transform: uppercase
}

    p {
    color: #333;
    font-family: inherit;
    text-align: left;
    padding: 8px 0 8px 0;
}


    footer {
        position: relative;
        bottom: 50px;
        right: 0px;
        width: 100%;
        height: 50px;
}

    .content {
    background-color: #FFFFFF;
    box-sizing: border-box;
    margin: 0;
    text-align: left;
    width: 100%;
    position: relative;
    left: 40px;
    display: inline-block;
    height: 100%;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

js .cd-top--fade-out {
        opacity: .5
    }
.js .cd-top--is-visible {
        visibility: visible;
        opacity: 1
    }
.js .cd-top {
        visibility: hidden;
        opacity: 0;
        transition: opacity .3s, visibility .3s, background-color .3s
    }

.cd-top {
    position: fixed;
    bottom: 20px;
    bottom: const(--cd-back-to-top-margin);
    right: 20px;
    right: const(--cd-back-to-top-margin);
    display: inline-block;
    height: 40px;
    height: const(--cd-back-to-top-size);
    width: 40px;
    width: const(--cd-back-to-top-size);
    box-shadow: 0 0 10px rgba(0, 0, 0, .05) !important;
    background: url(https://res.cloudinary.com/dxfq3iotg/image/upload/v1571057658/cd-top-arrow.svg) no-repeat center 50%;
    background-color: #e68781;
    background-color: hsla(const(--cd-color-3-h), const(--cd-color-3-s), const(--cd-color-3-l), 0.8)
}
        
#toTopBtn {
    position: fixed;
    bottom: 26px;
    right: 39px;
    z-index: 98;
    padding: 21px;
    background-color: #e68781
}

button {
    color: #466995;
    font-family: inherit;
    font-size: 11px;
    font-weight: bold;
    letter-spacing: 0.05em;
    text-align: center;
    text-transform: uppercase;
    padding: 15px 15px;
    border-radius: 4px;
    border: 2px solid #466995;
    background-color: transparent;
    outline: none;
}

button:hover {
  color: black;
}

.clicked {
    background-color: pink;
}

.divider {
    padding: 10px;
    display: inline-block
}

#abundance {
    width: 900px;
    border: 2px solid #ced4da;
    overflow: scroll;
}

#vertical-scroll {
    max-height: 500px;
    border: 2px solid #ced4da;
    overflow: scroll;
}

#legend {
    display: inline-block;
    position: absolute;
    right: 350px; 
    top: 450px;
}

img {
    max-width: 1200px;
}

table {
  border-collapse: collapse;
  width: 100%;
}

thead {
  background-color: #5f92c5;
  color: white;
}

th, td {
  padding: 8px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

tr:nth-child(even){background-color: #f2f2f2}
tr:hover {background-color: #b7d9fa;}

    </style>
</head>

<body>
<script>
    $(document).ready(function() {
        $(window).scroll(function() {
            if ($(this).scrollTop() > 20) {
                $('#toTopBtn').fadeIn();
            } else {
                $('#toTopBtn').fadeOut();
            }
        });

        $('#toTopBtn').click(function() {
            $("html, body").animate({
                scrollTop: 0
            }, 400);
            return false;
        });
    });
</script>

<div class='container'>
    <a href="#" id="toTopBtn" class="cd-top text-replace js-cd-top cd-top--is-visible cd-top--fade-out" data-abc="true"></a>
    <header>
        <div class="col-sm-8" style="text-align: left;">
            <img class="mscape-logo" src="https://raw.githubusercontent.com/artic-network/scylla/main/docs/mscape.svg" vertical-align="left" width="30" height="30"></img>
            mSCAPE | <small>metagenomics Surveillance Collaboraton and Analysis Programme</small>
        </div>
        <div class="col-sm-4" style="text-align: right;">
            Negative Controls | <small>Summary report</small>
        </div>
        <br>
        <hr>
        <div class="spacer">
            &nbsp;
        </div>
    </header>

<h1>${site_name} Report</h1>
<p class="lead">Data provided by mSCAPE.</p>
<p class="description">This report summarises contamination found in negative control samples in ${site_name}. Reads were classified against Kraken2 using epi2me-labs/wf-metagenomics provided by Oxford Nanopore Technologies. Kraken is known to have a high false positive rate. Results should be interpreted with caution. </p>

<h3>Read abundance by microbial clade</h3>
<script>
function toggleElements(showElement, hideElements) {
    document.querySelectorAll(hideElements).forEach(el => el.style.display = "none");
    document.querySelector(showElement).style.display = "inline-block";
}
</script>

<script>
    function clickFunction(str) {
    
     var original = document.getElementById("original");
     var filtered = document.getElementById("filtered");
       
       if(str==1){
    
       original.classList.toggle("clicked");
       filtered.classList.remove("clicked");
        }else{
    
       filtered.classList.toggle("clicked");
       original.classList.remove("clicked");
       
        }
    
    }
</script>

<button id="original" class= "clicked" onclick="toggleElements('.visible', '.plot'); clickFunction(1)">Absolute Abundance</button> 
<button id="filtered" class="" onclick="toggleElements('.hide_', '.plot'); clickFunction(-1)">Relative Abundance</button>
<h3 class="divider"> | </h3>
<div class="visible plot" style="display: inline-block">
    <button onclick="toggleElements('.bacteria', '.abun')">Bacteria</button> 
    <button onclick="toggleElements('.fungi', '.abun')">Fungi</button>
    <button onclick="toggleElements('.virus', '.abun')">Viruses</button>
    <button onclick="toggleElements('.archaea', '.abun')">Archaea</button>
    <button onclick="toggleElements('.protist', '.abun')">Protists</button>
</div>
<div class="hide_ plot" style="display: none">
    <button onclick="toggleElements('.relbacteria', '.abun')">Bacteria</button> 
    <button onclick="toggleElements('.relfungi', '.abun')">Fungi</button>
    <button onclick="toggleElements('.relvirus', '.abun')">Viruses</button>
    <button onclick="toggleElements('.relarchaea', '.abun')">Archaea</button>
    <button onclick="toggleElements('.relprotist', '.abun')">Protists</button>
</div>
<br>
<br>

<div class="bacteria abun", style="display: inline-block"> 
    <div id="abundance", style="display: inline-block">
        <img src="data:image/png;base64,${bac_abs}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the total read count found for all bacteria in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${bac_abun_l}"
            alt="Embedded Bar Graph depicting the total read count found for all bacteria in each dataset.">
        </div>
    </div>
</div>

<div class="fungi abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${fungi_abs}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the total read count found for all fungi in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${fungi_abun_l}"
            alt="Embedded Bar Graph depicting the total read count found for all fungi in each dataset.">
        </div>
    </div>
</div>

<div class="archaea abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${archaea_abs}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the total read count found for all archaea in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${archaea_abun_l}"
            alt="Embedded Bar Graph depicting the total read count found for all archaea in each dataset.">
        </div>
    </div>
</div>

<div class="virus abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${virus_abs}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the total read count found for all viruses in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${virus_abun_l}"
            alt="Embedded Bar Graph depicting the total read count found for all viruses in each dataset.">
        </div>
    </div>
</div>

<div class="protist abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${protist_abs}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the total read count found for all protists in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${protist_abun_l}"
            alt="Embedded Bar Graph depicting the total read count found for all protists in each dataset.">
        </div>
    </div>
</div>

<div class="relbacteria abun", style="display: none"> 
    <div id="abundance", style="display: inline-block">
        <img src="data:image/png;base64,${bac_rel}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the average read count found for all bacteria in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${bac_abun_l}"
            alt="Embedded Bar Graph depicting the average read count found for all bacteria in each dataset.">
        </div>
    </div>
</div>

<div class="relfungi abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${fungi_rel}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the average read count found for all fungi in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${fungi_abun_l}"
            alt="Embedded Bar Graph depicting the average read count found for all fungi in each dataset.">
        </div>
    </div>
</div>

<div class="relarchaea abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${archaea_rel}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the average read count found for all archaea in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${archaea_abun_l}" 
            alt="Embedded Bar Graph depicting the average read count found for all archaea in each dataset.">
        </div>
    </div>
</div>

<div class="relvirus abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${virus_rel}" height="500" width="${no_sample}*150"
        alt="Embedded Bar Graph depicting the average read count found for all viruses in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${virus_abun_l}"
            alt="Embedded Bar Graph depicting the average read count found for all viruses in each dataset.">
        </div>
    </div>
</div>

<div class="relprotist abun" style="display: none">
    <div id="abundance">
        <img src="data:image/png;base64,${protist_rel}" height="500" width="${no_sample}*150" left="800" 
        alt="Embedded Bar Graph depicting the average read count found for all protists in each dataset.">
        <div id="legend">
            <img src="data:image/png;base64,${protist_abun_l}" 
            alt="Embedded Bar Graph depicting the average read count found for all protists in each dataset.">
        </div>
    </div>
</div>

<p class="ont_ref" style="text-align: left;"><strong>The absolute abundance of reads found in each sample in ${site_name}.</strong>, displaying the top 10 taxa across the site.</p>

<script>
function clickFunction(str) {

 var original = document.getElementById("original");
 var filtered = document.getElementById("filtered");
   
   if(str==1){

   original.classList.toggle("clicked");
   filtered.classList.remove("clicked");
    }else{

   filtered.classList.toggle("clicked");
   original.classList.remove("clicked");
   
    }

}
</script>
<br>
<br>

<h3>Pathogenicity of identified contaminants</h3>
<button onclick="toggleElements('.zepto', '.map')">ZeptoMetrix</button>
<button onclick="toggleElements('.patho', '.map')">Pathogenic | Potentially Pathogenic</button>
<button onclick="toggleElements('.oppor', '.map')">Opportunistic | Potentially Opportunistic</button>
<button onclick="toggleElements('.comme', '.map')">Generally Commensal | Commensal</button>

<div class="zepto map" style="display: inline-block">
    <img src="data:image/png;base64,${zepto_map}" height="${zepto_count}*5" width="${width}*64"
    alt="Embedded heatmap depicting the read count found for zeptomatrix control taxa.">

    <p>Taxa also present in the ZeptoMetrix Respiratory Panel for positive controls.</p>
</div>

<div class="patho map" style="display: none">
    <img src="data:image/png;base64,${patho_map}" height="${patho_count}*5" width="${width}*64"
    alt="Embedded heatmap depicting the read count found for pathogenic/potentially pathogenic contaminant taxa.">
</div>

<div class="oppor map" style="display: none">
    <img src="data:image/png;base64,${oppor_map}" height="${oppor_count}*5" width="${width}*64"
    alt="Embedded heatmap depicting the read count found for opportunistic/potentially opportunistic contaminant taxa.">
</div>

<div class="comme map" style="display: none">
    <img src="data:image/png;base64,${comme_map}" height="${comme_count}*5" width="${width}*64"
    alt="Embedded heatmap depicting the read count found for generally_commensal/commensal contaminant taxa.">
</div>

<p style="padding-bottom: 0;"><strong>${annotation}</strong></p>
<p><strong>A non-exhaustive list of contaminants with known pathogenicity, as indicated by existing literature*</strong>. Taxa have been filtered for those appearing in more than 3 samples with over 5 reads. White spaces indicate where 0 counts have been found. Note: only ${nonan_taxa}/${all_taxa} taxa over the threshold have been cross-referenced with literature so far and represented here. *References can be found on github.com/aq-sun/contamination-data.</p>

<h3>Possible sources of contamination</h3>
<button onclick="toggleElements('.lab', '.niche')">Lab Environment</button>
<button onclick="toggleElements('.human', '.niche')">Human</button>
<button onclick="toggleElements('.industry', '.niche')">Industry</button>
<br>
<div class="lab niche" style="display: block">
    <img src="data:image/png;base64,${lab_map}" height="${lab_count}*5" width="${width}*64"
    alt="Embedded heatmap depicting the read count found for contaminant taxa also present in the laboratory.">
</div>

<div class="human niche" style="display: none">
    <img src="data:image/png;base64,${human_map}" height="${human_count}*5" width="${width}*64"
    alt="Embedded heatmap depicting the read count found for contaminant taxa also present on the human body.">
</div>

<div class="industry niche" style="display: none">
    <p>Previously found as industrial reagent contaminants in literature.</p>
    <img src="data:image/png;base64,${industry_map}" height="${industry_count}*5" width="${width}*64"
    alt="Embedded heatmap depicting the read count found for contaminant taxa that have also been present in industry.">
</div>

<p style="padding-bottom: 0;"><strong>${niche_annotations}</strong></p>
<p><strong>A non-exhaustive list of contaminants known by niche, as indicated by existing literature*</strong>. Taxa have been filtered for those appearing in more than 3 samples with over 5 reads. When taxa overlap between lab environment and other niches, we assume that the cause of their contamination is the lab environment and remove them from the other plots. White spaces indicate where 0 counts have been found. Note: only ${nonan_taxa}/${all_taxa} taxa over the threshold have been cross-referenced with literature so far and represented here. *References can be found on github.com/aq-sun/contamination-data.</p>


<h3>Site-specific signals</h3>
<button onclick="toggleElements('.table', '.signal')">Table</button> 
<button onclick="toggleElements('.heatmap', '.signal')">Heatmap</button>
<div class="table signal" style="display: block">
    <div id="vertical-scroll">${sig_table}</div>
    <p><strong>Average counts for all taxa that have a significantly higher count in ${site_name} than at least one other site, after fitting Welch's t-test.</strong> Comparison between the site ${site_name} and all other sites. The p-value indicates the smallest p-value between ${site_name} and at least one other site.</p>
</div>
<div class="heatmap signal" style="display: none">
    <div id="vertical-scroll"><img src="data:image/png;base64,${sigmap}" height="${sig_count}*5" width="${width}*64"
        alt="Heatmap depicting every taxa that is statistically significant in having a higher presence in this current site compared to at least one other site."/></div>
    <p><strong>Number of reads for all taxa that have a significantly higher count in ${site_name} than at least one other site, after fitting Welch's t-test.</strong> Taxa have been sorted in ascending order to show taxa with the smallest p-value first.</p>
</div>

<h3>Principal Coordinates Analysis (PCoA)</h3>
<img src="data:image/png;base64,${pcoa}" height=600 width=600
        alt="PcoA plot depicting a reduced-dimension similarity matrix between the samples of this site and all other sites."/>
        <p><strong>PcoA plot depicting a similarity matrix between the samples in ${site_name} and all other sites.</strong> ${permanova_annotation}</p>
<br>
<br>
<br>

<footer class="mscape-footer">
    <div class="container-fluid text-right text-md-right">
        <hr>
        <div class="row">
            <div class="col-sm-5" style="text-align: left;">
                <small class="text-muted">Developed by the ARTIC.network, funded by Wellcome</small>
                <br>
                <img class="artic_no_rings" src="https://raw.githubusercontent.com/artic-network/scylla/main/docs/artic_no_rings.svg" vertical-align="left" width="50" height="50"></img>
                <img class="wt" src="https://raw.githubusercontent.com/artic-network/scylla/main/docs/wellcome-logo-black.png" vertical-align="left" width="50" height="50"></img>
            </div>

            <div class="col-sm-11" style="text-align: right;">
                 | <small class="text-muted">Site report</small> <br><small class="text-muted">GNU General Public License v3.0</small>
            </div>
            <br>
            <br>
        </div>
</footer>

</div>
</body>
</html>
